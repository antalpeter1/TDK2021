
\section{Conclusions and future work}
The aim of this work is to develop and implement control algorithms for performing a backflip maneuver with miniature quadcopters. A thorough literature survey has been conducted about the mathematical modelling of quadcopter dynamics, control approaches for aggressive maneuvers, and specifically for backflipping. We have proposed two control approaches, the first of which is an open-loop strategy based on the optimization of a parametric motion primitive sequence, for which we have interpreted the work of \cite{LSICRA2010}, and extended it with Bayesian optimization. %We have found Bayesian optimization suitable for learning the backflip maneuver, the optimized parameter set worked very well on the quadcopter's simulation model. 
The second proposed strategy for backflipping is trajectory design and geometric feedback control for reference trajectory tracking. %The nonlinear geometric control is based on \cite{lelemc2010}, providing an almost globally stable control law on $SE(3)$.% We have used basic assumptions from the open-loop approach as well (e.g. duration of the maneuver) to define a reference trajectory for the attitude of the quadcopter, represented in unit quaternions. 
We have defined an attitude reference trajectory directly for the flip maneuver, and used it to design the position reference trajectory, computed as the solution of a constrained quadratic optimization problem on the discrete time model of the drone. %The trajectory design 

After the theoretical foundation of the mathematical model and control approaches, we have presented the simulation results, using the dynamic model of the Bitcraze Crazyflie 2.1 quadcopter. We have found Bayesian optimization efficient and suitable for learning the open-loop strategy for backflipping, the optimized parameter set worked with good performance on the quadcopter's simulation model. The trajectory design for the second control method is computationally efficient, flexible and general. With proper tuning of geometric control gains, simulations has shown accurate trajectory tracking both for the position and orientation of the quadcopter, performing the backflip maneuver with small errors. Due to the generality of the trajectory design method, it can be used to learn other complex maneuvers in a similar framing in the future.
%The control algorithms run on-board, therefore they are executed with high frequency, running at $~500$ Hz. An external motion capture system is used to provide accurate absolute position and orientation information for the drone at 120~Hz, the measurement of which is fused with the on-board sensor data using Extended Kalman Filter.

The experimental setup at SZTAKI AIMotion Lab has made it possible to implement both control methods on a real Crazyflie quadcopter. As it is displayed in Figure~\ref{fig:test}, the implementation was successful, the quadcopter performed the backflip with the open-loop and geometric control, as well. Open-loop control is very sensitive to parameter uncertainty, therefore we need to use a slightly different parameter set for each Crazyflie~2.1 quadcopter, although their nominal parameters are the same. However, geometric control provides a significantly more robust method for backflipping, as feedback balances small parameter uncertainties. The robustness of geometric tracking control is demonstrated by performing the backflip maneuver with three slightly different drones simultaneously, as it is illustrated in the supplementary video of the work, available at \url{https://youtu.be/AhqfXZ-CPqM}.

%The implementation of the open-loop backflipping has not been successful at first, it required manual refinement of the motion primitive parameters.  % Moreover, even small changes on the drone dynamics (e.g. replacing a reflective marker) can lead to instability of the motion control.

%The results of the second strategy has shown that precise attitude tracking can be achieved with the trajectory tracking control, although there are larger position errors. We also examined the possible reasons of differences between the simulation model and reality, highlighting complex aerodynamic effects and actuator dynamics. The robustness of the geometric control method is demonstrated by performing the backflip maneuver with three drones simultaneously, as it is illustrated in the supplementary video of the work, available at \url{https://youtu.be/AhqfXZ-CPqM}.
% The proposed approach also requires an additional stabilizing motion controller at the beginning and end of the maneuver, such as PID or geometric control. 

%The simulation and measurement results can be concluded as follows. The optimization-based open-loop approach has a simple structure, it is easy to understand and implement, and works well both in simulation and reality. However, it is designed specifically for backflipping, therefore it can not be easily extended to other complex maneuvers. Moreover, it is very sensitive to uncertain parameters, it needs manual tuning during the implementation on a real vehicle. The second strategy is more general, it can be easily extended to other maneuvers (e.g. a barrel roll) by redefining the attitude reference trajectory and the objective of the optimization. It is also more robust to model uncertainties, the exact same parameters are used for all Crazyflies opposed to the open-loop approach, and there is no need for manual tuning of the control gains.

The future goal of this project is to design even more general control methods for fast, complex maneuvers of miniature quadcopters, using machine learning techniques. The advantage of learning algorithms is that they require less expert knowledge, i.e. a simple task formulation is suitable to iteratively learn the desired motion. Reinforcement learning (RL), one of the most popular research topics in machine learning control is widely applied for learning and optimization of quadcopter maneuvers by trial and error, often combined with deep neural network policies. In our oncoming research work, we intend to use learning methods to perform complex maneuvers with less expert knowledge and extend the capabilities of the miniature quadcopters even more.

%investigate the adaptive control of quadcopters by reinforcement learning. In this semester, the first phase of the project has been completed, in the frame of which the following topics were examined. The nonlinear dynamic model and equations of motion of the quadcopter, the theoretical background and basic application of probabilistic reinforcement learning control, and a simple parametrized open-loop approach for executing a flip maneuver. The control strategy and optimization of the flip has been implemented in simulation with satisfactory results.

% Creating the experimental setup and the environment for the proper measurements was also an important aspect of the work so far. The AIMotion Lab started its activity in February 2021, and now there are demonstrations on the autonomous flight of the quadcopters. In order to implement our own control strategy, it was necessary to understand the structure of the Crazyflie's built-in controllers and high-level commands, as well as the handling of sensor data.

% Although the current experimental results are not completely satisfactory, our main focus is now on the improvement of recovery and restabilization after the maneuver, to be able to perform it multiple times safely. In the meantime, we also develop the simulation framework to fit the measurements as much as possible, so that we can start the training of learning algorithms in simulation domain, and easily adopt them to the real vehicle.

% For the next semester, the plan is to continue this work with the thorough study of reinforcement learning algorithms,  especially apprenticeship learning for the aggressive maneuvers of the quadrotor. Based on the work so far and the literature survey to come, the implementation of such algorithms will be possible both in simulation and experiment. I would also like to present this work at the BME Scientific Conference of Students, and the ultimate goal of the project is to submit a publication, as well.

\section*{Acknowledgement}
I would like to thank \textit{Tamás Péni} and \textit{Roland Tóth} at SZTAKI for the huge amount of help and professional support when facing both theoretical and practical problems. I would also like to thank \textit{István Harmati} at BME Department of Control Engineering and Information Technology for the useful advices regarding the documentation.